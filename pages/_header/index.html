<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://assets-decodeurs.lemonde.fr/redacweb/design-edito-new-app-v-0-1-demo/styles__demo.css">
  </head>
  <body class="lm-page demo-page">

    <!-- Application -->
    <style>.lm-page-config, .lm-app-config { display: none; }</style>
    <script src="/shared/index.js" type="module"></script>
    <!-- <script src="https://assets-decodeurs.lemonde.fr/design-edito/v0.1/shared/index.js" type="module"></script> -->

    <!-- Config -->
    <data class="lm-page-config" value="approxPublicationDate">2023-06-10</data>
    <data class="lm-page-config" value="id">demo-lm-apps</data>
    <data class="lm-page-config" value="textbaseInline">
      # collection
      ## obj
      _prop: value

      # collection
      ## obj
      _prop: other-value

      # collection
      ## obj
      _prop:RESET: reset-value

      # PAGE_CONFIG
        ## config
          _customFonts: euclid-flex-xl >>> toArray 1

      // HEADER =====================================
      
      # PAGE_SLOTS
        ## header-slot
          _selector: .header-slot
          _name: header
          _options: options/header-slot--initial-state >>> toRef
      
      # options
        ## header-slot--initial-state
          _customClass: my-header
          _hideLogo: false >>> toBoolean
          _hideNav: false >>> toBoolean
          _hideCta: false >>> toBoolean
          _fill1: blue
          _fill2: red
          _fillTransitionTime: 600ms
          _navItems: options/header-nav-item-
            >>> toArray 2
            >>> map append %pos%
            >>> map toRef
          _navItemsAlign: center
          _ctaContent: <strong>I am the CTA</strong> >>> toHtml
          _ctaActionType: toggle-panel
          _panelContent: <div style="height: 400px; background-color: violet; margin-top: 8px;">
            <strong>I am the panel dude</strong>
          </div> >>> toHtml

        ## header-nav-item-0
          _value: item-0
          _content: Item 0
          _isActive: false >>> toBoolean

        ## header-nav-item-1
          _value: item-1
          _content: Item 1
          _isActive: true >>> toBoolean

        ## header-slot--dark-state
          _fill1: red
          _fill2: blue
      
      // SCRLLGNGN =====================================
  
      # PAGE_SLOTS
        ## scrllgngn-slot
          _selector: .scrllgngn-slot
          _name: scrllgngn
          _options: options/scrllgngn-slot >>> toRef
      
      # options
        ## scrllgngn-slot
          _thresholdOffset: 80vh
          _pages: options/scrllgngn-page-
            >>> toArray 2
            >>> map append %pos%
            >>> map toRef
        
        ## scrllgngn-page-0
          _id: page-0
          _bgColor: coral
          _blocks: options/scrllgngn-page-0-block-0 >>> toArray 1 >>> map toRef
          // _dispatchOnEnter: set-header-props, options/header-slot--initial-state
          //   >>> split ,
          //   >>> map trim
          //   >>> map toRef
          // _dispatchOnLeave: update-header-props, options/header-slot--dark-state
          //   >>> split ,
          //   >>> map trim
          //   >>> map toRef

        ## scrllgngn-page-0-block-0
          _id: page-0-block-0
          _type: html
          _content: <div style="height: 120vh; display: flex; align-items: center;"><h1>PAGE 1</h1></div> >>> toHtml
          _depth: scroll
        
        ## scrllgngn-page-1
          _id: page-1
          _bgColor: cornflowerblue
          _blocks: options/scrllgngn-page-1-block-0 >>> toArray 1 >>> map toRef

        ## scrllgngn-page-1-block-0
          _id: page-1-block-0
          _type: html
          _content: <div style="height: 120vh; display: flex; align-items: center;"><h1>PAGE 2</h1></div> >>> toHtml
          _depth: scroll

      // EVENT-DISPATCHER-1 =====================================

      # PAGE_SLOTS
        ## event-dispatcher-1-slot
          _selector: .event-dispatcher-1-slot
          _name: event-dispatcher
          _options: options/event-dispatcher-1-slot >>> toRef
        
      # options
        ## event-dispatcher-1-slot
          _customClass: my-event-dispatcher-1
          _trigger: enter-bottom
          _instruction: update-header-props
          _payload: options/event-dispatcher-1-payload >>> toRef
        
        ## event-dispatcher-1-payload
          _fill1: orange
      
      // EVENT-DISPATCHER-2 =====================================

      # PAGE_SLOTS
        ## event-dispatcher-2-slot
          _selector: .event-dispatcher-2-slot
          _name: event-dispatcher
          _options: options/event-dispatcher-2-slot >>> toRef
        
      # options
        ## event-dispatcher-2-slot
          _customClass: my-event-dispatcher-2
          _trigger: leave-bottom
          _instruction: update-header-props
          _payload: options/event-dispatcher-2-payload >>> toRef
        
        ## event-dispatcher-2-payload
          _fill1: blue

    </data>
    <script>setTimeout(() => {
      console.log(window.LM_PAGE.database.get('collection').get('obj').get('prop').value)
    }, 1000)</script>

    <!-- Slots -->
    <style>
      .header-slot {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 3;
      }
    </style>
    <div class="header-slot"></div>
    <div class="scrllgngn-slot"></div>
    <div class="event-dispatcher-1-slot" style="margin-top: 120vh; position: absolute; top: 0;"></div>
    <div class="event-dispatcher-2-slot" style="margin-bottom: 120vh; position:  absolute; top: 120vh;"></div>
  </body>
</html>
